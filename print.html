<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js dark">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Ceres Book</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "dark";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('dark')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="quickstart.html"><strong aria-hidden="true">2.</strong> Quickstart</a></li><li class="chapter-item expanded "><a href="prerequisites/index.html"><strong aria-hidden="true">3.</strong> Prerequisites</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="prerequisites/ink-contract.html"><strong aria-hidden="true">3.1.</strong> ink! contract</a></li><li class="chapter-item expanded "><a href="prerequisites/cargo-contract.html"><strong aria-hidden="true">3.2.</strong> cargo-contract</a></li></ol></li><li class="chapter-item expanded "><a href="cli/index.html"><strong aria-hidden="true">4.</strong> CLI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/call.html"><strong aria-hidden="true">4.1.</strong> call</a></li><li class="chapter-item expanded "><a href="cli/deploy.html"><strong aria-hidden="true">4.2.</strong> deploy</a></li><li class="chapter-item expanded "><a href="cli/info.html"><strong aria-hidden="true">4.3.</strong> info</a></li><li class="chapter-item expanded "><a href="cli/list.html"><strong aria-hidden="true">4.4.</strong> list</a></li></ol></li><li class="chapter-item expanded "><a href="tutorials/index.html"><strong aria-hidden="true">5.</strong> Tutorials</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tutorials/debug/index.html"><strong aria-hidden="true">5.1.</strong> debug ink! contract</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tutorials/debug/getting-started.html"><strong aria-hidden="true">5.1.1.</strong> Getting Started</a></li></ol></li><li class="chapter-item expanded "><a href="tutorials/tests/index.html"><strong aria-hidden="true">5.2.</strong> write tests for ink! contract</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tutorials/tests/getting-started.html"><strong aria-hidden="true">5.2.1.</strong> Getting Started</a></li></ol></li><li class="chapter-item expanded "><a href="tutorials/browser/index.html"><strong aria-hidden="true">5.3.</strong> run ink! contract in browser</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tutorials/browser/getting-started.html"><strong aria-hidden="true">5.3.1.</strong> Getting Started</a></li></ol></li><li class="chapter-item expanded "><a href="tutorials/impl/index.html"><strong aria-hidden="true">5.4.</strong> write your implementation of ceres</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tutorials/impl/getting-started.html"><strong aria-hidden="true">5.4.1.</strong> Getting Started</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The Ceres Book</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/patractlabs/ceres" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ceres"><a class="header" href="#ceres">Ceres</a></h1>
<p>Ceres provides an enviroment for running ink! contract outside of substrate.</p>
<ul>
<li><a href="tutorials/debug">debug ink! contract</a></li>
<li><a href="tutorials/tests">write tests for ink! contract</a></li>
<li><a href="tutorials/browser">run ink! contract in browser</a></li>
<li><a href="tutorials/impl">write your implementation of ceres</a></li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="quickstart"><a class="header" href="#quickstart">Quickstart</a></h1>
<h2 id="0-install-cargo-contract"><a class="header" href="#0-install-cargo-contract">0. Install <code>cargo-contract</code></a></h2>
<pre><code>cargo install cargo-contract
</code></pre>
<h2 id="1-install-ceres"><a class="header" href="#1-install-ceres">1. Install <code>ceres</code></a></h2>
<pre><code>cargo install ceres
</code></pre>
<h2 id="2-run-cargo-contract-new"><a class="header" href="#2-run-cargo-contract-new">2. Run <code>cargo contract new</code></a></h2>
<pre><code>cargo contract new flipper
</code></pre>
<h3 id="3-compile-with-debug-info"><a class="header" href="#3-compile-with-debug-info">3. Compile with debug info</a></h3>
<pre><code>cargo contract build
</code></pre>
<h3 id="4-test-flipper"><a class="header" href="#4-test-flipper">4. Test flipper</a></h3>
<pre><code>ceres target/ink/flipper.contract info
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h1>
<p>First you'll want to install the <a href="https://github.com/patractlabs/ceres">ceres</a> CLI, and wasm-pack -V should print the
version that you just installed.</p>
<p>Next, you'll need to donwload <code>cargo-contract</code> for compiling your ink! contract to wasm
binaries.</p>
<p>Finally, use the <a href="prerequisites/../cli">commands</a> of the CLI or follow the <a href="prerequisites/../tutorials">Tutorials</a>
to start your journey.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ink-contract"><a class="header" href="#ink-contract">ink! contract</a></h1>
<p>Since <code>ceres</code> is an execution of ink! contract, we need to have an ink! contract
first of all.</p>
<h3 id="0-download-cargo-contract"><a class="header" href="#0-download-cargo-contract">0. Download <code>cargo-contract</code></a></h3>
<p>For generating an ink! contract, we need to download <code>cargo-contract</code></p>
<pre><code>cargo install cargo-contract --force
</code></pre>
<h3 id="1-new-ink-contract"><a class="header" href="#1-new-ink-contract">1. New ink! contract</a></h3>
<p>Once we have <code>cargo-contract</code> installed in our machine, we can run </p>
<pre><code>cargo new my-ink-contract
</code></pre>
<p>to generate a template ink contract.</p>
<h3 id="2-compile-ink-contract"><a class="header" href="#2-compile-ink-contract">2. Compile ink! contract</a></h3>
<pre><code>cd my-ink-contract
cargo contract build
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="patractlabscargo-contract"><a class="header" href="#patractlabscargo-contract"><code>patractlabs/cargo-contract</code></a></h1>
<p>For compiling ink! contract with debug info, we can use <code>patractlabs/cargo-contract</code>
along with <code>ceres</code>.</p>
<h2 id="0-installation"><a class="header" href="#0-installation">0. Installation</a></h2>
<pre><code>cargo install --git https://github.com/patractlabs/cargo-contract.git --branch tag-v0.12.1 --force
</code></pre>
<h2 id="1-compile-with-debug-info"><a class="header" href="#1-compile-with-debug-info">1. Compile with debug info</a></h2>
<pre><code> ùù∫ cargo contract build -h
cargo-contract-build 0.10.0
Executes build of the smart-contract which produces a wasm binary that is ready for deploying.

It does so by invoking `cargo build` and then post processing the final binary.

USAGE:
    cargo contract build [FLAGS] [OPTIONS]

FLAGS:
    -d, --debug      Enable debug info in the wasm bundle
    -h, --help       Prints help information
        --quiet      No output printed to stdout
    -V, --version    Prints version information
        --verbose    Use verbose output

OPTIONS:
        --generate &lt;all | code-only&gt;       Which build artifacts to generate. [default: all]
        --manifest-path &lt;manifest-path&gt;    Path to the Cargo.toml of the contract to build
    -Z, --unstable-options &lt;options&gt;...    Use the original manifest (Cargo.toml), do not modify for build optimizations
</code></pre>
<p>See the <code>--debug</code> flag, run <code>cargo build -d</code> in the contract path will embed
debug info in the wasm of our contract.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="cli"><a class="header" href="#cli">CLI</a></h1>
<p><code>ceres</code> has an CLI implementation to help you debug contracts in command line.</p>
<pre><code> ùù∫ ceres
ceres 0.2.0
Ceres command tool

USAGE:
    ceres [*.contract | name | code-hash] &lt;SUBCOMMAND&gt;

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

ARGS:
    &lt;*.contract | name | code-hash&gt;    If empty, ceres will load the last contract which has been executed

SUBCOMMANDS:
    call      Calls a call method
    deploy    Calls a deploy method
    help      Prints this message or the help of the given subcommand(s)
    info      Prints info of *.contract
    list      Lists all contracts
</code></pre>
<h2 id="arguments"><a class="header" href="#arguments">Arguments</a></h2>
<p>Once we use <code>*.contract</code> as the argument of <code>ceres</code>, ceres will load and record
the target contract in database(~/.ceres) by default.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ceres-call"><a class="header" href="#ceres-call">ceres call</a></h1>
<p>The <code>ceres call</code> command call a method of the supplied contract.</p>
<pre><code> ùù∫ ceres call -h
ceres-call
Calls a call method

USAGE:
    ceres call [OPTIONS] &lt;method&gt;

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

OPTIONS:
        --address &lt;address&gt;                        Contract callee
    -b, --balance &lt;balance&gt;                        contract balance
        --caller &lt;caller&gt;                          Contract caller
    -m, --minimum-balance &lt;minimum-balance&gt;        minimum balance
    -n, --now &lt;now&gt;                                current time
    -a, --args &lt;string,&gt;...                        Arguments
    -v, --value-transferred &lt;value-transferred&gt;    transferred value

ARGS:
    &lt;method&gt;    Calling method
</code></pre>
<p>The options of method <code>call</code> are destructed from <code>Transaction</code></p>
<h3 id="address"><a class="header" href="#address">address</a></h3>
<p>Callee address</p>
<h3 id="balance"><a class="header" href="#balance">balance</a></h3>
<p>Contract balance</p>
<h3 id="caller"><a class="header" href="#caller">caller</a></h3>
<p>Caller address</p>
<h3 id="minimum-balance"><a class="header" href="#minimum-balance">minimum-balance</a></h3>
<p><code>minimum_balance</code> in transaction</p>
<h3 id="now"><a class="header" href="#now">now</a></h3>
<p>Transaction time</p>
<h3 id="args"><a class="header" href="#args">args</a></h3>
<p>Transaction arguments, should be <code>parity-scale-codec</code> format</p>
<h3 id="value"><a class="header" href="#value">value</a></h3>
<p>Transferred value</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ceres-deploy"><a class="header" href="#ceres-deploy">ceres deploy</a></h1>
<p>The <code>ceres deploy</code> command deploy the supplied contract with constructor, like <code>ceres call</code></p>
<pre><code> ùù∫ ceres deploy -h
ceres-deploy
Calls a deploy method

USAGE:
    ceres deploy [OPTIONS] &lt;method&gt;

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

OPTIONS:
        --address &lt;address&gt;                        Contract callee
    -b, --balance &lt;balance&gt;                        contract balance
        --caller &lt;caller&gt;                          Contract caller
    -m, --minimum-balance &lt;minimum-balance&gt;        minimum balance
    -n, --now &lt;now&gt;                                current time
    -a, --args &lt;string,&gt;...                        Arguments
    -v, --value-transferred &lt;value-transferred&gt;    transferred value

ARGS:
    &lt;method&gt;    Calling method
</code></pre>
<p>The options of method <code>deploy</code> are destructed from <code>Transaction</code></p>
<h3 id="address-1"><a class="header" href="#address-1">address</a></h3>
<p>Callee address</p>
<h3 id="balance-1"><a class="header" href="#balance-1">balance</a></h3>
<p>Contract balance</p>
<h3 id="caller-1"><a class="header" href="#caller-1">caller</a></h3>
<p>Caller address</p>
<h3 id="minimum-balance-1"><a class="header" href="#minimum-balance-1">minimum-balance</a></h3>
<p><code>minimum_balance</code> in transaction</p>
<h3 id="now-1"><a class="header" href="#now-1">now</a></h3>
<p>Transaction time</p>
<h3 id="args-1"><a class="header" href="#args-1">args</a></h3>
<p>Transaction arguments, should be <code>parity-scale-codec</code> format</p>
<h3 id="value-1"><a class="header" href="#value-1">value</a></h3>
<p>Transferred value</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ceres-info"><a class="header" href="#ceres-info">ceres info</a></h1>
<p>Shows <code>info</code> of the current contract</p>
<pre><code> ùù∫ ceres info -h
ceres-info 0.2.0
Prints info of *.contract

USAGE:
    ceres info

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information
</code></pre>
<p>This will print the info of the last contract ceres rememberred or
we can execute this with contract argument.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ceres-list"><a class="header" href="#ceres-list">ceres list</a></h1>
<p>Lists loaded contracts</p>
<pre><code> ùù∫ ceres list -h
ceres-list 0.2.0
Lists all contracts

USAGE:
    ceres list

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information
</code></pre>
<p>for example</p>
<pre><code> ùù∫ ceres list

	contract             code-hash
	---------------------------------------------------------------------------------------
	delegator            0x85970b066ab92b4495bba682917ded604019a6fce9b247c36b35e8c967287f4f
	accumulator          0x906811f0dca85909fd267df762c09de7a6af62cd1f1aa73d3778d58d308fd376
	adder                0xc60c90582f3e6767d9b8cca5b83f747b8b86afb8c425b2e23dfad5e4784409e1
	subber               0xcc9b22fda1a527754190c8833b919a26cf440bd9aca7f0e5810104f09a8e0b82
</code></pre>
<p>The code-hash displayed could be used in <code>call-contracts</code></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tutorials"><a class="header" href="#tutorials">Tutorials</a></h1>
<p>We have three tutorials that help you get started with <code>ceres</code>:</p>
<ul>
<li><a href="tutorials/debug">If you want to debug ink! contract</a></li>
<li><a href="tutorials/tests">If you want to write tests for ink! contract</a></li>
<li><a href="tutorials/browser">If you want to run ink! contract in browser</a></li>
<li><a href="tutorials/impl">If you want to write a implementation for ceres</a></li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="debug-ink-contract"><a class="header" href="#debug-ink-contract">debug ink! contract</a></h1>
<p>The goal of this tutorial is to introduce you to use ceres 
for debuging ink! contract.</p>
<p>Be sure to have read and followed the 
<a href="tutorials/debug/../../prerequisites">Prerequisites</a>.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<h3 id="0-compile-ink-contract-with-debug-info"><a class="header" href="#0-compile-ink-contract-with-debug-info">0. Compile ink! contract with debug info</a></h3>
<p>For <code>cargo-contract</code>, see <a href="tutorials/debug/../../prerequisites/cargo-contract.html">3.2</a>.</p>
<h3 id="1-introduce-trap-in-ceres"><a class="header" href="#1-introduce-trap-in-ceres">1. Introduce <code>Trap</code> in ceres</a></h3>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// A trap code describing the reason for a trap.
///
/// All trap instructions have an explicit trap code.
#[non_exhaustive]
#[derive(Clone, Debug, PartialEq, Eq)]
pub enum TrapCode {
    /// The current stack space was exhausted.
    StackOverflow,

    /// An out-of-bounds memory access.
    MemoryOutOfBounds,

    /// A wasm atomic operation was presented with a not-naturally-aligned linear-memory address.
    HeapMisaligned,

    /// An out-of-bounds access to a table.
    TableOutOfBounds,

    /// Indirect call to a null table entry.
    IndirectCallToNull,

    /// Signature mismatch on indirect call.
    BadSignature,

    /// An integer arithmetic operation caused an overflow.
    IntegerOverflow,

    /// An integer division by zero.
    IntegerDivisionByZero,

    /// Failed float-to-int conversion.
    BadConversionToInteger,

    /// Code that was supposed to have been unreachable was reached.
    UnreachableCodeReached,

    /// Execution has potentially run too long and may be interrupted.
    Interrupt,

    /// HostError
    HostError(Box&lt;Error&gt;),

    // Unknown Error
    Unknown,

    // Termination
    Termination,

    // Restoration
    Restoration,
}

<span class="boring">}
</span></code></pre></pre>
<p><code>ceres</code> supports <code>Trap</code> both from <code>wasmi</code> and <code>wasmtime</code></p>
<ul>
<li><a href="https://github.com/paritytech/wasmi/blob/a899ebb8d6eeb7a08029735cc03fd54b546cb791/src/lib.rs#L177">wasmi trap</a></li>
<li><a href="https://github.com/bytecodealliance/wasmtime/blob/065190f975e7e94650d85d35d3fbea5448a746bd/crates/wasmtime/src/trap.rs#L55">wasmtime trap</a></li>
</ul>
<h3 id="2-embed-panic-in-contract"><a class="header" href="#2-embed-panic-in-contract">2. Embed <code>panic</code> in contract</a></h3>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span>#![cfg_attr(not(feature = &quot;std&quot;), no_std)]

<span class="boring">fn main() {
</span>use ink_lang as ink;

#[ink::contract]
mod flipper_trap {
    #[ink(storage)]
    pub struct FlipperTrap {
        value: bool,
    }

    impl FlipperTrap {
        #[ink(constructor)]
        pub fn new(init_value: bool) -&gt; Self {
            Self { value: init_value }
        }

        #[ink(constructor)]
        pub fn default() -&gt; Self {
            Self::new(Default::default())
        }

        #[ink(message)]
        pub fn flip(&amp;mut self) {
            panic!(&quot;trap here&quot;);
            self.value = !self.value;
        }

        /// Simply returns the current value of our `bool`.
        #[ink(message)]
        pub fn get(&amp;self) -&gt; bool {
            self.value
        }
    }
}

<span class="boring">}
</span></code></pre></pre>
<h3 id="3-catch-the-trap-in-contract"><a class="header" href="#3-catch-the-trap-in-contract">3. Catch the trap in contract</a></h3>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[test]
fn test_flipper_trap() {
    // Assume we compile the contract in `2.` to `flipper_trap.contract`
    let mut rt = Runtime::contract(
        include_bytes!(&quot;flipper_trap.contract&quot;),
        Some(Instance),
    )
    .expect(&quot;Create runtime failed&quot;);

    rt.deploy(&quot;default&quot;, vec![], None).expect(&quot;Deploy failed&quot;);
    assert_eq!(rt.call(&quot;get&quot;, vec![], None), Ok(Some(vec![0])));

    if let Some(ceres_runtime::Error::CallContractFailed {
        error: ceres_executor::Error::Trap(Trap { code, .. }),
    }) = rt.call(&quot;flip&quot;, vec![], None).err()
    {
        assert_eq!(code, TrapCode::UnreachableCodeReached);
    } else {
        panic!(&quot;Call flipper_trap with unexpected error&quot;);
    }
}

<span class="boring">}
</span></code></pre></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="write-tests-for-ink-contract"><a class="header" href="#write-tests-for-ink-contract">write tests for ink! contract</a></h1>
<p>In this chapter, we'll introduce how to write tests of ink! contract with 
ceres, as an ink! contract executor, it is really easy.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="getting-started-1"><a class="header" href="#getting-started-1">Getting Started</a></h1>
<h3 id="0-template-contract"><a class="header" href="#0-template-contract">0. Template contract</a></h3>
<p>First of all, we need an ink! contract, flipper here.</p>
<pre><code>cargo contract new flipper
</code></pre>
<h3 id="1-add-buildrs-to-our-contract"><a class="header" href="#1-add-buildrs-to-our-contract">1. add <code>build.rs</code> to our contract</a></h3>
<pre><pre class="playground"><code class="language-rust">// flipper/build.rs
use std::process::Command;

fn main() {
    println!(&quot;cargo:rerun-if-changed=src/lib.rs&quot;);
    Command::new(&quot;cargo&quot;).args(&amp;[&quot;contract&quot;, &quot;build&quot;]);
}
</code></pre></pre>
<h3 id="2-add-ceres-as-dev-dependencies"><a class="header" href="#2-add-ceres-as-dev-dependencies">2. add ceres as <code>dev-dependencies</code></a></h3>
<pre><code class="language-toml">[dev-dependencies]
ceres = &quot;^0&quot;
</code></pre>
<h3 id="3-write-tests-with-ceres"><a class="header" href="#3-write-tests-with-ceres">3. write tests with ceres</a></h3>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// /tests/flipper.rs
use ceres_executor::{Trap, TrapCode};
use ceres_ri::Instance;
use ceres_runtime::Runtime;
use parity_scale_codec::Encode;

#[test]
fn test_flipper() {
    let mut rt = Runtime::contract(
        include_bytes!(&quot;../contracts/flipper.contract&quot;),
        Some(Instance),
    )
    .expect(&quot;Create runtime failed&quot;);

    rt.deploy(&quot;default&quot;, vec![], None).expect(&quot;Deploy failed&quot;);
    assert_eq!(rt.call(&quot;get&quot;, vec![], None), Ok(Some(vec![0])));

    rt.deploy(&quot;new&quot;, vec![true.encode()], None)
        .expect(&quot;Deploy failed&quot;);
    assert_eq!(rt.call(&quot;get&quot;, vec![], None), Ok(Some(vec![1])));

    rt.call(&quot;flip&quot;, vec![], None).expect(&quot;Call contract failed&quot;);
    assert_eq!(rt.call(&quot;get&quot;, vec![], None), Ok(Some(vec![0])));
}
<span class="boring">}
</span></code></pre></pre>
<h3 id="4-run-tests"><a class="header" href="#4-run-tests">4. run tests</a></h3>
<pre><code># flipper/
cargo test
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="run-ink-contract-in-browser"><a class="header" href="#run-ink-contract-in-browser">run ink! contract in browser</a></h1>
<p>Ceres supports <code>no_std</code> which means we can run ink! contract in browser with
ceres as well.</p>
<p>This chapter will introduce how to run ink! contract in browser!</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="getting-started-2"><a class="header" href="#getting-started-2">Getting Started</a></h1>
<h3 id="0-prepare-your-ink-contract"><a class="header" href="#0-prepare-your-ink-contract">0. prepare your ink! contract</a></h3>
<p>Please follow the instructions of <a href="tutorials/browser//prerequisites/ink-contract.html">prerequisites/ink! contract</a>
to generate an ink! contract.</p>
<h3 id="1-use-patractceres-browser-in-your-package"><a class="header" href="#1-use-patractceres-browser-in-your-package">1. use <code>@patract/ceres-browser</code> in your package</a></h3>
<pre><code class="language-json">{
  dependencies: {
    &quot;@patract/ceres-browser&quot;: &quot;^0.1.4&quot;
  }
}
</code></pre>
<h3 id="2-run-ink-contract-with-ceres"><a class="header" href="#2-run-ink-contract-with-ceres">2. run ink! contract with ceres</a></h3>
<pre><code class="language-typescript">import { Runtime } from &quot;@ceres/browser&quot;;

// this flipper.contract is the output after `0.`
// under /target/ink/flipper.contract
import CONTRACT from &quot;flipper.contract&quot;;

(async () =&gt; {
    const rt = new Runtime(contract.toString());
    // arguments of call or deploy should be 
    // parity-scale-codec encoded
    rt.deploy(&quot;default&quot;, []);
    rt.call(&quot;default&quot;, []);
});
</code></pre>
<p>The usage of <code>@patract/ceres-browser</code> is as same as the rust exports, 
more functions please check <a href="https://docs.rs/ceres-runtime/0.1.0/ceres_runtime/struct.Runtime.html">docs.rs/ceres</a>.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="write-your-implementation-of-ceres"><a class="header" href="#write-your-implementation-of-ceres">write your implementation of ceres</a></h1>
<p>ceres supports both <code>wasmi</code> and <code>wasmtime</code> as wasm executor, which means 
you can run ink! contract with ceres anywhere.</p>
<h2 id="when-should-i-use-ceres-with-wsmtime-feature"><a class="header" href="#when-should-i-use-ceres-with-wsmtime-feature">When should I use ceres with <code>wsmtime</code> feature?</a></h2>
<p><code>wasmtime</code> is the default and recommanded executor of ceres, fast and
full features.</p>
<h2 id="when-should-i-use-ceres-with-wasmi-feature"><a class="header" href="#when-should-i-use-ceres-with-wasmi-feature">When should I use ceres with <code>wasmi</code> feature?</a></h2>
<p>If you have requirements running ceres in browser or some IoT devices,
you don't want any <code>std</code> dependencies of rust, you need to use ceres
with <code>wasmi</code> feature.</p>
<h2 id="why-customized-implementation"><a class="header" href="#why-customized-implementation">Why customized implementation?</a></h2>
<p>ceres supports the seal functions provided by <code>pallet-contracts</code> of 
substrate by default, so if you want to use ceres in some special 
devices, you need to re-implement the seal functions yourselves.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="getting-started-3"><a class="header" href="#getting-started-3">Getting Started</a></h1>
<h3 id="0-implement-your-storage"><a class="header" href="#0-implement-your-storage">0. implement your <code>storage</code></a></h3>
<p>The <code>Storage</code> trait in <code>ceres/crate/support</code> is the entry of ceres storage, 
first of all, we need to construct a storage for our implementation.</p>
<p>For example, the storage implementation of <code>ceres-cli</code> is like:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use ceres_support::traits::{self, Cache, Frame};

/// A ceres storage implementation using sled
#[derive(Clone)]
pub struct Storage {
    pub db: Db,
    cache: Tree,
    frame: Vec&lt;Rc&lt;RefCell&lt;State&lt;Memory&gt;&gt;&gt;&gt;,
    state: HostState,
}

impl traits::Storage for Storage {
    fn set(&amp;mut self, key: Vec&lt;u8&gt;, value: Vec&lt;u8&gt;) -&gt; Option&lt;Vec&lt;u8&gt;&gt; {
        self.cache.insert(key, value).ok()?.map(|v| v.to_vec())
    }

    fn remove(&amp;mut self, key: &amp;[u8]) -&gt; Option&lt;Vec&lt;u8&gt;&gt; {
        self.cache.remove(key).ok()?.map(|v| v.to_vec())
    }

    fn get(&amp;self, key: &amp;[u8]) -&gt; Option&lt;Vec&lt;u8&gt;&gt; {
        self.cache.get(key).ok()?.map(|v| v.to_vec())
    }
}

impl Cache&lt;Memory&gt; for Storage {
    fn frame(&amp;self) -&gt; &amp;Vec&lt;Rc&lt;RefCell&lt;State&lt;Memory&gt;&gt;&gt;&gt; {
        &amp;self.frame
    }

    fn frame_mut(&amp;mut self) -&gt; &amp;mut Vec&lt;Rc&lt;RefCell&lt;State&lt;Memory&gt;&gt;&gt;&gt; {
        &amp;mut self.frame
    }

    fn memory(&amp;self) -&gt; Option&lt;Memory&gt; {
        Some(self.frame.last()?.borrow().memory.clone())
    }

    /// Flush data
    fn flush(&amp;mut self) -&gt; Option&lt;()&gt; {
        for state in self.frame.iter() {
            let state = state.borrow().clone();
            self.state.insert(state.hash, state.state);
        }

        let mut data = if let Some(state) = self.db.get(PREVIOUS_STATE).ok()? {
            HostState::decode(&amp;mut state.as_ref()).ok()?
        } else {
            BTreeMap::new()
        };

        data.append(&amp;mut self.state.clone());
        self.db.insert(PREVIOUS_STATE, data.encode()).ok()?;
        self.db.flush().ok()?;
        Some(())
    }
}

impl Frame&lt;Memory&gt; for Storage {}
<span class="boring">}
</span></code></pre></pre>
<h3 id="1-construct-your-seal-calls"><a class="header" href="#1-construct-your-seal-calls">1. construct your seal calls</a></h3>
<p>we need to construct seal calls for different platforms, for example, <code>ceres-cli</code> use 
system interfaces, <code>ceres-browser</code> use browser interfaces.</p>
<p>For example, the seal calls of <code>ceres-browser</code> is like</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use ceres_sandbox::{RuntimeInterfaces, Sandbox};

/// Browser interface
pub struct Interface;

impl RuntimeInterfaces for Interface {
    /// Println
    fn seal_println(sandbox: &amp;mut Sandbox, args: &amp;[Value]) -&gt; Ret {
        if args.len() != 2 {
            return Err(Error::WrongArugmentLength);
        }

        let data = sandbox.read_sandbox_memory(args[0].into(), args[1].into())?;
        if let Ok(utf8) = core::str::from_utf8(&amp;data) {
            log(utf8);
        }

        Ok(None)
    }

    /// Generate random value
    fn seal_random(sandbox: &amp;mut Sandbox, args: &amp;[Value]) -&gt; Ret {
        if args.len() != 4 {
            return Err(Error::WrongArugmentLength);
        }
        let subject_ptr = args[0].into();
        let subject_len = args[1].into();
        let output_ptr: u32 = args[2].into();
        let output_len: u32 = args[2].into();

        // random
        let mut dest: [u8; 1] = [0];
        err_check(getrandom(&amp;mut dest));
        let mut subject_buf = sandbox
            .read_sandbox_memory(subject_ptr, subject_len)?
            .to_vec();
        subject_buf.push(dest[0]);

        let output = blake2b::blake2b(32, &amp;[], &amp;subject_buf);
        sandbox.write_sandbox_output(output_ptr, output_len, output.as_bytes())?;
        Ok(None)
    }

    /// sha2 256
    fn seal_hash_sha2_256(sandbox: &amp;mut Sandbox, args: &amp;[Value]) -&gt; Ret {
        if args.len() != 3 {
            return Err(Error::WrongArugmentLength);
        }
        let input_ptr = args[0].into();
        let input_len = args[1].into();
        let output_ptr = args[2].into();

        // hash
        let mut dest: [u8; 32] = [0; 32];
        let mut hasher = Sha256::new();
        let input = sandbox.read_sandbox_memory(input_ptr, input_len)?;
        hasher.update(&amp;input);
        dest.copy_from_slice(&amp;hasher.finalize());
        sandbox.write_sandbox_memory(output_ptr, dest.as_ref())?;

        // result
        Ok(None)
    }

    /// keccak 256
    fn seal_hash_keccak_256(sandbox: &amp;mut Sandbox, args: &amp;[Value]) -&gt; Ret {
        if args.len() != 3 {
            return Err(Error::WrongArugmentLength);
        }
        let input_ptr = args[0].into();
        let input_len = args[1].into();
        let output_ptr = args[2].into();

        // hash
        let mut dest: [u8; 32] = [0; 32];
        let mut keccak = Keccak::v256();
        let input = sandbox.read_sandbox_memory(input_ptr, input_len)?;
        keccak.update(&amp;input);
        keccak.finalize(&amp;mut dest);
        sandbox.write_sandbox_memory(output_ptr, dest.as_ref())?;

        // result
        Ok(None)
    }

    /// blake2 256
    fn seal_hash_blake2_256(sandbox: &amp;mut Sandbox, args: &amp;[Value]) -&gt; Ret {
        if args.len() != 3 {
            return Err(Error::WrongArugmentLength);
        }
        let input_ptr = args[0].into();
        let input_len = args[1].into();
        let output_ptr = args[2].into();

        // hash
        let mut dest = [0; 32];
        let input = sandbox.read_sandbox_memory(input_ptr, input_len)?;
        dest.copy_from_slice(blake2b::blake2b(32, &amp;[], &amp;input).as_bytes());
        sandbox.write_sandbox_memory(output_ptr, dest.as_ref())?;

        // result
        Ok(None)
    }

    /// blake2 128
    fn seal_hash_blake2_128(sandbox: &amp;mut Sandbox, args: &amp;[Value]) -&gt; Ret {
        if args.len() != 3 {
            return Err(Error::WrongArugmentLength);
        }
        let input_ptr = args[0].into();
        let input_len = args[1].into();
        let output_ptr = args[2].into();

        // hash
        let mut dest = [0; 16];
        let input = sandbox.read_sandbox_memory(input_ptr, input_len)?;
        dest.copy_from_slice(blake2b::blake2b(16, &amp;[], &amp;input).as_bytes());
        sandbox.write_sandbox_memory(output_ptr, dest.as_ref())?;

        // result
        Ok(None)
    }
}

<span class="boring">}
</span></code></pre></pre>
<h3 id="2-build-runtime-with-your-implementations"><a class="header" href="#2-build-runtime-with-your-implementations">2. Build <code>Runtime</code> with your implementations</a></h3>
<pre><pre class="playground"><code class="language-rust">/// This Instance has `RuntimeInterfaces` trait bundled
use my_runtime_interfaces::Instance;
use my_storage::Storage;

fn main() {
    let storage = Storage::new();
    let rt = Runtime::from_contract(&amp;source, storage, Some(Instance));
}
</code></pre></pre>
<p>Here we go, a new implementation of ceres.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
